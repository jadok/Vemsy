{"version":3,"file":"index.cjs.js","sources":["../src/config/files.js","../src/config/logs.js","../src/setup/config.js","../src/setup/express.js","../src/setup/express-middleware.js","../src/type/page.js","../src/type/template.js","../src/utils/func.js","../src/type/middleware.type.js","../src/type/template.type.js","../src/type/page.type.js","../src/type/type.js","../src/type/index.js","../src/setup/global-library.js","../src/setup/lift.js","../src/utils/path.js","../src/setup/theme-init.js","../src/setup/theme-pages.js","../src/setup/logger.js","../src/setup/index.js","../src/utils/async.js","../src/middleware/data.js","../src/middleware/markdown.js","../src/middleware/render.js","../src/middleware/render-theme.js","../src/utils/route-like-page.js","../src/middleware/routing-theme.js","../src/middleware/routing-file.js","../src/middleware/index.js","../src/index.js"],"sourcesContent":["export default {\n  \"app_path\": {\n    \"contents\": \"./app/contents\",\n    \"public\": \"./public\",\n    \"themes\": \"./app/themes\",\n    \"views\": \"views\"\n  }\n}\n","export default {\n  \"winston\": {\n    \"file\": {\n      \"level\": \"info\",\n      \"filename\": \"./logs/app.log\",\n      \"handleExceptions\": true,\n      \"json\": true,\n      \"maxsize\": 5242880,\n      \"maxFiles\": 5,\n      \"colorize\": false\n    },\n    \"console\": {\n      \"level\": \"debug\",\n      \"handleExceptions\": true,\n      \"json\": false,\n      \"colorize\": true\n    }\n  }\n}\n","import merge from 'deepmerge'\nimport includesAll from 'include-all'\nimport { Task } from 'middleware-setup'\nimport { join } from 'path'\n\nimport files from '../config/files.js'\nimport logs from '../config/logs.js'\n\nconst pathAppConfigs = join(process.cwd(), 'app', 'config')\n\nexport default class extends Task {\n  async execute() {\n    try {\n      const coreConfigs = { files, logs }\n      const appConfigs = includesAll({\n        dirname: pathAppConfigs,\n        filter: /(.+)\\.js$/,\n        excludeDirs: /^\\.(git|svn)$/\n      })\n\n      global.__app.configs = merge(coreConfigs, appConfigs)\n      global.__app.configs.name = global.__app.configs.name\n        || require(join(process.cwd(), 'package.json')).name\n    }\n    catch (err) {\n      throw new Error(err)\n    }\n  }\n}\n","import express from 'express'\nimport { Task } from 'middleware-setup'\n\nexport default class extends Task {\n  async execute() {\n    __app.server = express()\n  }\n}\n","import { Task } from 'middleware-setup'\n\nexport default class extends Task {\n  constructor(middlewares) {\n    super(middlewares)\n    this.middlewares = middlewares\n  }\n\n  async execute() {\n    if (typeof __app.server === 'undefined') {\n      throw new Error('Server not up.')\n    }\n    this.middlewares.forEach((middleware) => {\n      t(middleware).isExpressMiddleware ?\n        __app.server.use(middleware)\n        : __app.server.use(middleware())\n    })\n  }\n}\n","export default class Page {\n  constructor(route = '', template = null, plugins = [], name = '') {\n    this.route = route\n    this.plugins = plugins\n    this.template = template\n    this.name = name\n  }\n}\n","export default class Template {\n  constructor(filename = '', plugins = []) {\n    this.filename = filename\n    this.plugins = plugins\n  }\n}\n","const ARGUMENT_NAMES = /([^\\s,]+)/g\nconst STRIP_COMMENTS = /((\\/\\/.*$)|(\\/\\*[\\s\\S]*?\\*\\/))/mg\nconst STANDARD_FUNC_DEFINITION = /.*\\)[\\s]+{/mg\n\nconst isAnonymousSingleParameter = fnStr => {\n  const firstBracket = fnStr.indexOf('(') + 1\n  const lastBracket =  fnStr.indexOf(')')\n  const anonymousDefinition = fnStr.indexOf('=>')\n  const standardDefinition = fnStr.match(STANDARD_FUNC_DEFINITION)\n  if (anonymousDefinition === -1 && standardDefinition === null) {\n    return ''\n  }\n  if (anonymousDefinition !== -1 && (anonymousDefinition < lastBracket || lastBracket < 0)) {\n    return fnStr.slice(0, anonymousDefinition).trim()\n  }\n  return fnStr.slice(firstBracket, lastBracket)\n}\n\nconst getParamNames = (func) => {\n  const fnStr = func.toString().replace(STRIP_COMMENTS, '')\n  const result = isAnonymousSingleParameter(fnStr).match(ARGUMENT_NAMES)\n  return result === null ? [] : result\n}\n\nexport default getParamNames\n","import getParamNames from '../utils/func.js'\n\n/**\n * Some people implements express middleware with differents form express middleware.\n * Some due to their code style don't write parameter name if the parameter is not used\n *  - like (, res)\n */\nconst PARAMS_VALIDATOR = {\n  req: ['', 'req', 'request'],\n  res: ['', 'res', 'response', undefined],\n  next: ['next', undefined]\n}\n\nconst middlewareTypeCheck = (input) => {\n  const params = getParamNames(input)\n  if (PARAMS_VALIDATOR.req.indexOf(params[0]) === -1) {\n    return false\n  }\n  if (PARAMS_VALIDATOR.res.indexOf(params[1]) === -1) {\n    return false\n  }\n  return (PARAMS_VALIDATOR.next.indexOf(params[2]) != -1)\n}\n\nexport default middlewareTypeCheck\n","import Template from './template.js'\n\nimport middlewareTypeCheck from './middleware.type.js'\n\nconst templateTypeCheck = (input) => {\n  return input instanceof Template\n    && input.plugins.reduce((acc, currPlugins) => acc && middlewareTypeCheck(currPlugins), true)\n    && typeof input.filename === \"string\"\n}\n\nexport default templateTypeCheck\n","import Template from './template.js'\n\nimport middlewareTypeCheck from './middleware.type.js'\nimport templateTypeCheck from './template.type.js'\n\nconst pageTypeCheck = (input) => {\n  return input.template instanceof Template && templateTypeCheck(input.template)\n    && input.plugins.reduce((acc, currPlugins) => acc && middlewareTypeCheck(currPlugins), true)\n    && typeof input.route === \"string\"\n}\n\nexport default pageTypeCheck\n","import { addCustomTypes } from 'typy'\n\nimport middlewareTypeCheck from './middleware.type.js'\nimport pageTypeCheck from './page.type.js'\nimport templateTypeCheck from './template.type.js'\n\naddCustomTypes({\n  isExpressMiddleware: middlewareTypeCheck,\n  isPage: pageTypeCheck,\n  isTemplate: templateTypeCheck\n})\n","import { t } from 'typy'\n\nimport Page from './page.js'\nimport Template from './template.js'\n\nimport './type.js'\n\nexport const type = {\n  Page,\n  Template\n}\n\nexport default t\n","import { Task } from 'middleware-setup'\n\nimport t from '../type/index.js'\n\nexport default class extends Task {\n  async execute() {\n    global.t = t\n  }\n}\n","import { Task } from 'middleware-setup'\n\nexport default class extends Task {\n  async execute() {\n    // Set process title\n    __app.title = process.env.APP_NAME || __app.configs.name || '';\n    console.log(__app.title, 'Lifting...')\n    // Bind server to port\n    __app.server.set('port', __app.configs.port || 1337);\n    __app.server.listen(__app.server.get('port'));\n  }\n}\n","import { join } from 'path'\n\nconst filePathToPath = (filePath) =>\n  join(process.cwd(), ...filePath.split('/'))\n\nexport default filePathToPath\n","import { Task } from 'middleware-setup'\n\nimport filePathToPath from '../utils/path.js'\n\nexport default class extends Task {\n  async execute() {\n    global.__app.theme = {\n      motor: __app.configs.files.theme_motor,\n      name: __app.configs.files.theme_name\n    }\n    const viewDir = filePathToPath(\n      __app.configs.files.app_path.themes\n      + '/' + __app.configs.files.theme_name\n      + '/' + __app.configs.files.app_path.views\n    )\n\n    if (__app.theme.motor === 'twig') {\n      __app.server.set(\"twig options\", {\n        allow_async: true, // Allow asynchronous compiling\n        strict_variables: false\n      });\n    }\n    __app.server.set('views', viewDir);\n    __app.server.set('view engine', __app.theme.motor); // register the template engine\n  }\n}\n","const includesAll = require('include-all')\nimport { Task } from 'middleware-setup'\nimport { join } from 'path'\n\nexport default class extends Task {\n  async execute() {\n    const themePagesDir = join(\n      __app.configs.files.app_path.themes\n      + '/' + __app.configs.files.theme_name\n    )\n    const tmpApp = { ...global.__app }\n    const pages = includesAll({\n      dirname: themePagesDir,\n      filter: /(.+)\\.js$/,\n      excludeDirs: /^\\.(git|svn)$/\n    })\n    global.__app = tmpApp\n    global.__app.theme.pages = Object.keys(pages.pages).map((pageName) => {\n      pages.pages[pageName].name = pageName\n      return pages.pages[pageName]\n    })\n  }\n}\n","import { Task } from 'middleware-setup'\nimport morgan from 'morgan'\nimport * as winston from 'winston'\n\nexport default class extends Task {\n  async execute() {\n    const logger = winston.createLogger({\n      transports: [\n          new winston.transports.File(__app.configs.logs.winston.file),\n          new winston.transports.Console(__app.configs.logs.winston.console)\n      ],\n      exitOnError: false\n    })\n    logger.stream = {\n      write: message => logger.info(message)\n    }\n    __app.server.use(morgan(\"combined\", { \"stream\": logger.stream }))\n  }\n}\n","import config from './config.js'\nimport express from './express.js'\nimport expressMiddleware from './express-middleware.js'\nimport globalLibrary from './global-library.js'\nimport lift from './lift.js'\nimport themeInit from './theme-init.js'\nimport themePages from './theme-pages.js'\nimport logger from './logger.js'\n\nglobal.__app = {}\n\nexport default {\n  config,\n  express,\n  expressMiddleware,\n  globalLibrary,\n  lift,\n  logger,\n  themeInit,\n  themePages\n}\n","const asyncHandler = fn => (req, res, next) =>\n  Promise\n    .resolve(fn(req, res, next))\n    .catch(next)\n\nexport default asyncHandler\n","import fs from 'fs'\nimport util from 'util'\n\nimport filePathToPath from '../utils/path.js'\nimport asyncHandler from '../utils/async.js'\n\nconst readFile = util.promisify(fs.readFile)\n\nconst dataMiddleware = async (req, res, next) => {\n  if (!req.variables.file) {\n    return next()\n  }\n  try {\n    const filePath = req.variables.file\n    const data = await readFile(filePathToPath(filePath), 'utf-8')\n    req.variables.data = data\n  }\n  catch (e) {\n    console.error(e, req.variables, req.variables.file)\n    req.variables.data = ''\n  }\n  return next()\n}\n\nexport default asyncHandler(dataMiddleware)\n","import markdown from 'markdown'\nimport asyncHandler from '../utils/async.js'\n\nconst markdownMiddleware = (req, res, next) => {\n  if (typeof req.variables.data !== 'undefined') {\n    const rendered = markdown.markdown.toHTML(req.variables.data.toString())\n    req.variables.markdown = rendered\n  }\n  return next()\n}\n\nexport default asyncHandler(markdownMiddleware)\n","const renderMiddleware = (req, res) => {\n  if (typeof req.variables.markdown !== 'undefined') {\n    res.set('Content-Type', 'text/html')\n    res.send(req.variables.markdown)\n  }\n  else {\n    res.status(404)\n    res.send('Error file not found')\n  }\n}\n\nexport default renderMiddleware\n","const renderTemplateMiddleware = (req, res) => {\n  const template = req.hidden_variables.pages[0]\n    .template.filename + '.html.twig'\n  res.render(template, req.variables)\n}\n\nexport default renderTemplateMiddleware\n","export const descPageRouteOrder = (a, b) => b.route.length - a.route.length\n\n/**\n * Get the list of defined path matching the route.\n *\n * @param {string[]} pages\n *   List of paths\n * @param {string} route\n *   actual route to test\n *\n * @return\n *   list of defined path matching the route\n */\nexport const testRoutes = (pages, route) => {\n  const matchingRoutes = pages.reduce((acc, page) => {\n    const reg = new RegExp(page.route)\n    const t = reg.test(route)\n    if (t) {\n      acc.push(page)\n    }\n    return (acc)\n  }, [])\n  return matchingRoutes.sort(descPageRouteOrder)\n}\n","import { testRoutes } from '../utils/route-like-page.js'\n\nconst routingTheme = (req, res, next) => {\n  if (typeof req.hidden_variables !== 'undefined') {\n    req.hidden_variables.pages = testRoutes(__app.theme.pages, req.path)\n  }\n  return next()\n}\n\nexport default routingTheme\n","import fs from 'fs'\nimport { join } from 'path'\nimport util from 'util'\n\nconst stat = util.promisify(fs.stat)\n\nexport const routingFileMiddleware = (\n  viewPath\n) => async (req, res, next) => {\n  if (typeof req.variables === 'undefined') {\n    req.variables = {}\n  }\n  if (typeof req.hidden_variables === 'undefined') {\n    req.hidden_variables = {}\n  }\n  // use the middleware if no file extension is provided\n  if (req.originalUrl.indexOf('.') === -1) {\n    // generate a windows readable path\n    req.variables.file = viewPath + req.originalUrl.toString()\n    try {\n      const stats = await stat(req.variables.file + '/')\n      req.variables.file = stats.isDirectory() ?\n        join(viewPath + req.originalUrl.toString(), 'README.md')\n        : viewPath + req.originalUrl.toString() + '.md'\n    }\n    catch (e) {\n      req.variables.file = viewPath + req.originalUrl.toString() + '.md'\n    }\n\n  }\n  else {\n    req.variables.assetFile = req.originalUrl.toString()\n  }\n  return next()\n}\n\nexport const configureMiddleware = () => routingFileMiddleware(__app.configs.files.app_path.contents)\n","import data from './data.js'\nimport markdown from './markdown.js'\nimport render from './render.js'\nimport renderTheme from './render-theme.js'\nimport routingTheme from './routing-theme.js'\nimport { configureMiddleware } from './routing-file.js'\n\nexport default {\n  data,\n  markdown,\n  render,\n  renderTheme,\n  routingFile: configureMiddleware,\n  routingTheme\n}\n","import setup from './setup/index.js'\nimport middleware from './middleware/index.js'\nimport { type } from './type/index.js'\n\nimport { runner, Task } from 'middleware-setup'\n\nexport default {\n  middleware,\n  runner,\n  setup,\n  type,\n  Task\n}\n"],"names":["pathAppConfigs","join","process","cwd","Task","execute","coreConfigs","files","logs","appConfigs","includesAll","dirname","filter","excludeDirs","global","__app","configs","merge","name","require","err","Error","server","express","constructor","middlewares","forEach","middleware","t","isExpressMiddleware","use","Page","route","template","plugins","Template","filename","ARGUMENT_NAMES","STRIP_COMMENTS","STANDARD_FUNC_DEFINITION","isAnonymousSingleParameter","fnStr","firstBracket","indexOf","lastBracket","anonymousDefinition","standardDefinition","match","slice","trim","getParamNames","func","toString","replace","result","PARAMS_VALIDATOR","req","res","undefined","next","middlewareTypeCheck","input","params","templateTypeCheck","reduce","acc","currPlugins","pageTypeCheck","addCustomTypes","isPage","isTemplate","type","title","env","APP_NAME","console","log","set","port","listen","get","filePathToPath","filePath","split","theme","motor","theme_motor","theme_name","viewDir","app_path","themes","views","allow_async","strict_variables","themePagesDir","tmpApp","pages","Object","keys","map","pageName","logger","winston","transports","File","file","Console","exitOnError","stream","write","message","info","morgan","config","expressMiddleware","globalLibrary","lift","themeInit","themePages","asyncHandler","fn","Promise","resolve","catch","readFile","util","promisify","fs","dataMiddleware","variables","data","e","error","markdownMiddleware","rendered","markdown","toHTML","renderMiddleware","send","status","renderTemplateMiddleware","hidden_variables","render","descPageRouteOrder","a","b","length","testRoutes","matchingRoutes","page","reg","RegExp","test","push","sort","routingTheme","path","stat","routingFileMiddleware","viewPath","originalUrl","stats","isDirectory","assetFile","configureMiddleware","contents","renderTheme","routingFile","runner","setup"],"mappings":"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"}